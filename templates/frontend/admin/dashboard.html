{% extends 'frontend/base.html' %}

{% block title %}Admin Dashboard - Helpdesk System{% endblock %}

{% block content %}
<h1 style="margin-bottom: 1.5rem;">Admin Dashboard</h1>

<div class="stats-grid">
    <div class="stat-card">
        <h3>{{ total_tickets }}</h3>
        <p>Total Tickets</p>
    </div>
    <div class="stat-card stat-card--open">
        <h3>{{ open_tickets }}</h3>
        <p>Open Tickets</p>
    </div>
    <div class="stat-card stat-card--resolved">
        <h3>{{ resolved_today }}</h3>
        <p>Resolved Today</p>
    </div>
    <div class="stat-card stat-card--overdue">
        <h3>{{ overdue_count }}</h3>
        <p>Overdue Tickets</p>
    </div>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
    <div class="card">
        <h2 style="margin-bottom: 1rem;">Recent Tickets</h2>
        {% if recent_tickets %}
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Customer</th>
                        <th>Status</th>
                        <th>Priority</th>
                        <th>Escalation</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in recent_tickets %}
                        <tr>
                            <td>#{{ item.ticket.id }}</td>
                            <td><a href="{% url 'admin_ticket_detail' item.ticket.id %}" style="color: #667eea;">{{ item.ticket.title|truncatewords:8 }}</a></td>
                            <td>{{ item.ticket.customer.name }}</td>
                            <td><span class="badge badge-{{ item.ticket.status|lower|slugify }}">{{ item.ticket.status }}</span></td>
                            <td><span class="badge badge-{{ item.ticket.priority|lower }}">{{ item.ticket.priority }}</span></td>
                            <td>
                                {% if item.sla_timer %}
                                    <span class="sla-timer {% if item.sla_timer.is_overdue %}overdue{% endif %}">{{ item.sla_timer.label }}</span>
                                {% else %}
                                    <span style="color: #9ca3af;">No SLA deadline</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="empty-state">No tickets yet</p>
        {% endif %}
    </div>
    
    <div>
        <div class="card">
            <h3 style="margin-bottom: 1rem;">Tickets by Status</h3>
            {% for item in tickets_by_status %}
                <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #e5e7eb;">
                    <span>{{ item.status }}</span>
                    <strong>{{ item.count }}</strong>
                </div>
            {% endfor %}
        </div>
        
        <div class="card" style="margin-top: 1.5rem;">
            <h3 style="margin-bottom: 1rem;">Tickets by Priority</h3>
            {% for item in tickets_by_priority %}
                <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #e5e7eb;">
                    <span>{{ item.priority }}</span>
                    <strong>{{ item.count }}</strong>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

